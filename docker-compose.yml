services:
  postgres:
    image: postgres:18
    container_name: postgres
    restart: unless-stopped
    environment:
      POSTGRES_USER: ${POSTGRES_USERNAME}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: ${POSTGRES_DATABASE}
    env_file:
      - .env
    ports:
    - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgres
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USERNAME} -d ${POSTGRES_DATABASE}"]
      interval: 10s
      timeout: 5s
      retries: 5

#  dagster-webserver:
#    build:
#      context: .
#      dockerfile: setup/dagster/Dockerfile
#    container_name: dagster_webserver
#    restart: unless-stopped
#    env_file:
#      - .env
#    environment:
#      DAGSTER_HOME: /opt/dagster/dagster_home
#    volumes:
#      - dagster_data:/opt/dagster/dagster_home
#    entrypoint:
#      - dagster-webserver
#      - -h
#      - '0.0.0.0'
#      - -p
#      - '3000'
#    ports:
#      - "3000:3000"
#    depends_on:
#      postgres:
#        condition: service_healthy
#
#  dagster-daemon:
#    build:
#      context: .
#      dockerfile: setup/dagster/Dockerfile
#    container_name: dagster_daemon
#    restart: unless-stopped
#    env_file:
#      - .env
#    environment:
#      DAGSTER_HOME: /opt/dagster/dagster_home
#    volumes:
#      - dagster_data:/opt/dagster/dagster_home
#    entrypoint:
#      - dagster-daemon
#      - run
#      - -w
#      - /app/workspace.yaml
#    depends_on:
#      dagster-webserver:
#        condition: service_started

#  streamlit:
#    image: ghcr.io/oliverking2/pf-streamlit:latest
#    container_name: finance_app
#    restart: unless-stopped
#    env_file:
#      - .env
#    ports:
#      - "8501:8501"
#    depends_on:
#      - postgres
#      - dagster-webserver

volumes:
  postgres_data:
    driver: local
  dagster_data:
    driver: local
