name: dbt_project
version: "1.0"
profile: duckdb_local

on-run-start:
  - "INSTALL httpfs; LOAD httpfs;"
  - |
    CREATE OR REPLACE SECRET s3_creds (
        TYPE S3,
        PROVIDER CONFIG,
        KEY_ID '{{ env_var('AWS_ACCESS_KEY_ID') }}',
        SECRET '{{ env_var('AWS_SECRET_ACCESS_KEY') }}',
        REGION '{{ env_var('AWS_REGION') }}'
    );

model-paths: ["models"]
seed-paths: ["seeds"]
macro-paths: ["macros"]
target-path: "target"
log-path: "logs"
packages-install-path: "dbt_packages"

clean-targets:
  - "target"
  - "logs"
  - "dbt_packages"

models:
  dbt_project:
    +materialized: view

    1_source:
      +materialized: table
      +schema: source
      +meta:
        dagster:
          group: dbt_source
      +tags: ["auto_eager"]

    2_staging:
      +schema: staging
      +meta:
        dagster:
          group: dbt_staging
      +tags: ["auto_eager"]

    3_mart:
      +schema: mart
      +meta:
        dagster:
          group: dbt_mart
      +tags: ["auto_eager", "auto_hourly"]
